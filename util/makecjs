#!/usr/bin/env node
const header = `
//
// THIS FILE IS AUTOMATICALLY GENERATED! DO NOT EDIT BY HAND!
//
;(function (global, factory) {
    typeof exports === 'object' && typeof module !== 'undefined'
        ? module.exports = factory(global)
        : typeof define === 'function' && define.amd
        ? define(factory) : factory(global)
}(( typeof self !== 'undefined' ? self
        : typeof window !== 'undefined' ? window
        : typeof global !== 'undefined' ? global
        : this
), function(global) {
    'use strict';
    global = global || {}; // existing version for noConflict()
    const _Base64 = global.Base64;
    const gBase64 = {}
`;
const footer = `
    global.Base64 = gBase64;
    gBase64.noConflict = () => {
        let Base64 = gBase64;
        global.Base64 = _Base64;
        return Base64;
    };
    //
    // export Base64 to the namespace
    //
    if (global['Meteor']) { // Meteor.js
        Base64 = gBase64;
    }
    // module.exports and AMD are mutually exclusive.
    // module.exports has precedence.
    if (typeof module !== 'undefined' && module.exports) {
        module.exports.Base64 = gBase64;
    }
    else if (typeof define === 'function' && define.amd) {
        // AMD. Register as an anonymous module.
        define([], function(){ return gBase64 });
    }
    // that's it!
    return {Base64: gBase64};
}));
`;

const fs = require("fs");

const mjs = "./esm.mjs";
const js = "./base64.js";

const data = fs.readFileSync(mjs, "utf8");
const body = data.replace(
  /\bexport {([^{}\s]+)( as ([^{}\s]+))?}/g,
  (_, $0, $1, $2) => ($2 ? `gBase64.${$2} = ${$0}` : `gBase64.${$0} = ${$0}`)
);
const result = `
${header}
${body}
${footer}
`;
fs.writeFileSync(js, result);
